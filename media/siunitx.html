<script>
    MathJax = {
        loader: {
            load: [
                "[custom]/siunitx.js",
                "[tex]/gensymb",
                "[tex]/color",
                "[tex]/html",
                "[tex]/cancel",
            ], //gensymb is required for \degree and \ohm
            paths: { custom: "./media" },
        },
        tex: {
            packages: {
                "[+]": ["siunitx", "gensymb", "color", "html", "cancel"],
            },
            //gensymb is required for \degree and \ohm
            //color is required for color options
            //cancel is required for cancelation of units
            inlineMath: { "[+]": [["$", "$"]] },
            /* global options for siunitx can go in the siunitx object on tex, see IOptions in options.ts for properties */
            // Uncomment example below:
            // siunitx: {
            // 	perMode: 'fraction'
            // }
        },
        options: {
            enableEnrichment: true,
            sre: {
                domain: "clearspeak", // better for speaking compound units vs mathspeak
            },
        },
        startup: {
            ready: async () => {
                MathJax.startup.defaultReady();
                async function fillTableWithSpeech(name, arr) {
                    var table = document.getElementById(name);
                    for (var j = 0; j < arr.length; j++) {
                        const capt = j;
                        const mml = await MathJax.tex2mmlPromise(
                            arr[capt],
                            {}
                        );
                        var regex = /(?:data-semantic-speech=")(.*?)(?:")/g;
                        var matches = [...mml.matchAll(regex)];
                        if (matches[0] === undefined) {
                            break; // accessibility is not turned on yet
                        }
                        table.rows[capt + 1].cells[2].innerText =
                            matches[0][1];
                    }
                }

                await fillTableWithSpeech("angTable", ang);
                await fillTableWithSpeech("numTable", num);
                await fillTableWithSpeech("complexnumTable", complexnum);
                await fillTableWithSpeech("unitTable", unit);
                await fillTableWithSpeech("qtyTable", qty);
                await fillTableWithSpeech("listTable", listStuff);
                await fillTableWithSpeech(
                    "declareSIUnitTable",
                    declareSIUnit
                );
            },
        },
    };
</script>
